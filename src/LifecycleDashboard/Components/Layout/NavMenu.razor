@*
    Main Navigation Menu for Lifecycle Dashboard

    Navigation structure:
    - Dashboard (home)
    - Applications
    - Tasks
    - Reports
    - Admin
    - Release Notes
*@

@inject IMockDataService MockDataService
@implements IDisposable

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">
            <i class="bi bi-bar-chart-fill brand-icon"></i>
            Lifecycle Dashboard
        </a>
        @* Mock Data Toggle *@
        <button class="btn btn-sm @(_mockDataEnabled ? "btn-warning" : "btn-outline-secondary")"
                @onclick="ToggleMockData"
                title="@(_mockDataEnabled ? "Mock data is ON - click to use real data" : "Mock data is OFF - click to enable mock data")">
            <i class="bi @(_mockDataEnabled ? "bi-database-fill" : "bi-database")"></i>
            @(_mockDataEnabled ? "Mock" : "Live")
        </button>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="nav flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <i class="bi bi-house nav-icon" aria-hidden="true"></i> Dashboard
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="applications">
                <i class="bi bi-pc-display nav-icon" aria-hidden="true"></i> Applications
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="tasks">
                <i class="bi bi-check-square nav-icon" aria-hidden="true"></i> My Tasks
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="heatmap">
                <i class="bi bi-fire nav-icon" aria-hidden="true"></i> Heatmap
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-section-header">
            <span>Analytics</span>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="reports">
                <i class="bi bi-graph-up nav-icon" aria-hidden="true"></i> Reports
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="repositories">
                <i class="bi bi-git nav-icon" aria-hidden="true"></i> Repositories
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="frameworks">
                <i class="bi bi-stack nav-icon" aria-hidden="true"></i> Frameworks
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="recommendations">
                <i class="bi bi-lightbulb nav-icon" aria-hidden="true"></i> Recommendations
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="incidents">
                <i class="bi bi-ticket-detailed nav-icon" aria-hidden="true"></i> Incidents
            </NavLink>
        </div>

        <div class="nav-section-header">
            <span>Administration</span>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="admin">
                <i class="bi bi-gear nav-icon" aria-hidden="true"></i> Admin
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="data-jobs">
                <i class="bi bi-arrow-repeat nav-icon" aria-hidden="true"></i> Data Jobs
                <WipBadge Size="sm" />
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="servicenow-import">
                <i class="bi bi-cloud-upload nav-icon" aria-hidden="true"></i> ServiceNow Import
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="incident-import">
                <i class="bi bi-ticket-perforated nav-icon" aria-hidden="true"></i> Incident Import
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="app-name-mapping">
                <i class="bi bi-arrow-left-right nav-icon" aria-hidden="true"></i> App Mapping
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="user-alerts">
                <i class="bi bi-person-exclamation nav-icon" aria-hidden="true"></i> User Alerts
            </NavLink>
        </div>

        <div class="nav-section-header">
            <span>Help</span>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="release-notes">
                <i class="bi bi-journal-text nav-icon" aria-hidden="true"></i> Release Notes
            </NavLink>
        </div>

        @* Mock Data Status Indicator *@
        <div class="nav-item px-3 mt-3">
            <div class="mock-data-indicator @(_mockDataEnabled ? "mock-enabled" : "mock-disabled")">
                <i class="bi @(_mockDataEnabled ? "bi-database-fill-gear" : "bi-database-check")"></i>
                <span>@(_mockDataEnabled ? "Using Mock Data" : "Using Live Data")</span>
            </div>
        </div>
    </nav>
</div>

@code {
    private bool _mockDataEnabled = true;

    protected override void OnInitialized()
    {
        _mockDataEnabled = MockDataService.IsMockDataEnabled;
        MockDataService.MockDataModeChanged += OnMockDataModeChanged;
    }

    private async Task ToggleMockData()
    {
        _mockDataEnabled = !_mockDataEnabled;
        await MockDataService.SetMockDataEnabledAsync(_mockDataEnabled);
    }

    private void OnMockDataModeChanged(object? sender, bool enabled)
    {
        _mockDataEnabled = enabled;
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        MockDataService.MockDataModeChanged -= OnMockDataModeChanged;
    }
}
